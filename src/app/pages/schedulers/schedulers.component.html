<div class="space-y-5">
  <header class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
    <div class="space-y-1">
      <h1 class="text-2xl font-semibold text-text">Đặt lịch chạy test</h1>
      <p class="text-sm text-text-dim">Quản lý tất cả các lịch chạy testcase theo suite, môi trường và kiểu lặp.</p>
    </div>
  </header>

  <section class="rounded-2xl border border-border-subtle bg-white/5 p-4 shadow-soft/20">
    <div class="flex flex-wrap items-center gap-2">
      <button
        *ngFor="let tab of statusTabs"
        type="button"
        class="pill-tab"
        [class.active]="statusFilter === tab.value"
        (click)="setStatusFilter(tab.value)"
        [attr.data-testid]="'tab-' + tab.id"
      >
        {{ tab.label }}
      </button>
    </div>

    <div class="mt-4 grid gap-3 grid-cols-1 xl:grid-cols-5">
      <label class="filter-field">
        <span>Project</span>
        <select [(ngModel)]="projectFilter" disabled>
          <option [value]="projectFilter">{{ projectDisplay }}</option>
        </select>
      </label>
      <label class="filter-field">
        <span>Environment</span>
        <select [(ngModel)]="envFilter" disabled>
          <option [value]="envFilter">{{ envDisplay }}</option>
        </select>
      </label>
      <label class="filter-field">
        <span>Suite</span>
        <select [(ngModel)]="suiteFilter" (change)="onFilterChange()">
          <option *ngFor="let suite of suiteList" [value]="suite">{{ suite }}</option>
        </select>
      </label>
      <label class="filter-field">
        <span>Thời gian</span>
        <select [(ngModel)]="dateRange" (change)="onDateRangeChange()">
          <option *ngFor="let opt of dateRangeOptions" [value]="opt.id">{{ opt.label }}</option>
        </select>
      </label>
      <label class="filter-field xl:col-span-1">
        <span>Tìm kiếm</span>
        <div class="search-box">
          <lucide-icon name="search" class="h-4 w-4 text-text-dim"></lucide-icon>
          <input
            type="search"
            [(ngModel)]="keyword"
            (input)="onSearch(keyword)"
            placeholder="Tìm theo tên lịch, suite, project, owner..."
          />
        </div>
      </label>
    </div>
  </section>

  <section class="rounded-2xl border border-border-subtle bg-white/5 p-4 shadow-soft/30">
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-text">
        <thead class="text-xs uppercase text-text-dim">
          <tr>
            <th>Tên lịch</th>
            <th>Suite</th>
            <th>Kiểu</th>
            <th>Lịch</th>
            <th>Next run</th>
            <th>Last run</th>
            <th>Trạng thái</th>
            <th class="text-right">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of pagedRows" class="table-row">
            <td>
              <p class="font-semibold text-text">{{ row.name }}</p>
              <p class="text-xs text-text-dim">Project: {{ row.projectCode }} • Env: {{ row.envName }} • Owner: {{ row.ownerName }}</p>
            </td>
            <td class="text-text-dim">{{ row.suiteName }}</td>
            <td>
              <span class="badge" [ngClass]="typeClass(row.scheduleType)">
                {{ typeLabel(row.scheduleType) }}
              </span>
            </td>
            <td class="text-text-dim">{{ row.schedulePatternDisplay }}</td>
            <td>
              <p class="text-text">{{ row.nextRunDisplay }}</p>
              <span *ngIf="row.nextRunSoon" class="badge warn">Sắp chạy</span>
            </td>
            <td>
              <p class="text-text">{{ row.lastRunTimeDisplay }}</p>
              <div class="flex items-center gap-2 text-xs text-text-dim">
                <span>{{ row.lastRunSummary }}</span>
                <span class="badge" [ngClass]="lastRunClass(row.lastRunStatus)">
                  {{ lastRunLabel(row.lastRunStatus) }}
                </span>
              </div>
            </td>
            <td>
              <span class="badge" [ngClass]="statusClass(row.status)">
                {{ statusLabel(row.status) }}
              </span>
            </td>
            <td class="text-right">
              <div class="flex justify-end gap-2">
                <button class="icon-btn primary" title="Chạy ngay" (click)="actionRunNow(row)">
                  <lucide-icon name="play" class="h-4 w-4"></lucide-icon>
                </button>
                <button
                  class="icon-btn warn"
                  [title]="row.status === 'active' ? 'Tạm dừng' : 'Tiếp tục'"
                  (click)="actionToggle(row)"
                >
                  <lucide-icon [name]="row.status === 'active' ? 'pause' : 'play'" class="h-4 w-4"></lucide-icon>
                </button>
                <button class="icon-btn neutral" title="Chỉnh sửa" (click)="actionEdit(row)">
                  <lucide-icon name="edit" class="h-4 w-4"></lucide-icon>
                </button>
                <button class="icon-btn danger" title="Xóa lịch" (click)="actionDelete(row)">
                  <lucide-icon name="trash-2" class="h-4 w-4"></lucide-icon>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="pagedRows.length === 0">
            <td colspan="8" class="py-6 text-center text-text-dim">
              Chưa có lịch chạy nào. Tạo lịch mới để bắt đầu tự động hóa.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <p class="text-sm text-text-dim">Tổng số lịch: {{ totalSchedules }}</p>
      <div class="flex items-center gap-3">
        <label class="text-sm text-text-dim">Page size</label>
        <select
          class="rounded-lg border border-border-subtle bg-white/5 px-2 py-1 text-sm text-text"
          [(ngModel)]="pageSize"
          (change)="onPageSizeChange(pageSize)"
        >
          <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
        </select>
        <div class="flex items-center gap-2 text-sm text-text">
          <button class="page-btn" [disabled]="pageIndex === 1" (click)="onPageChange(pageIndex - 1)">
            <lucide-icon name="chevron-left" class="h-4 w-4"></lucide-icon>
          </button>
          <span>Trang {{ pageIndex }} / {{ totalPages }}</span>
          <button class="page-btn" [disabled]="pageIndex === totalPages" (click)="onPageChange(pageIndex + 1)">
            <lucide-icon name="chevron-right" class="h-4 w-4"></lucide-icon>
          </button>
        </div>
      </div>
    </div>
  </section>
</div>
